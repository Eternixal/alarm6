<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nerdix Sentinel | v6.2.0 Lucky 9</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #020406;
            --card-bg: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --text-main: #EEF0F2;
            --text-muted: #6C727A;
            --accent: #2EE7B7; 
            --glow: rgba(46, 231, 183, 0.15);
        }

        body.mood-ujian { --accent: #FF4D4D; --glow: rgba(255, 77, 77, 0.15); }
        body.mood-belajar { --accent: #2EE7B7; --glow: rgba(46, 231, 183, 0.15); }
        body.mood-tugas { --accent: #38BDF8; --glow: rgba(56, 189, 248, 0.15); }
        body.mood-baca { --accent: #FBBF24; --glow: rgba(251, 191, 36, 0.15); }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); 
            color: var(--text-main); 
            height: 100vh; 
            overflow: hidden; 
            display: flex; 
            justify-content: center; 
            background-image: radial-gradient(circle at 50% 10%, var(--glow) 0%, #020406 100%); 
            transition: background 0.8s ease; 
        }

        .screen { 
            position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; 
            background: var(--bg); background-image: radial-gradient(circle at 50% 10%, var(--glow) 0%, #020406 100%);
            transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1), transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 1; visibility: visible; z-index: 100;
        }

        .screen.hide { opacity: 0; visibility: hidden; transform: scale(0.98); pointer-events: none; }

        .theme-grid { width: 100%; max-width: 340px; display: grid; grid-template-columns: 1fr; gap: 10px; margin: 25px 0; }
        .theme-box { background: var(--card-bg); border: 1px solid var(--border); padding: 15px; border-radius: 18px; display: flex; align-items: center; gap: 15px; cursor: pointer; transition: 0.3s; }
        .theme-box.selected { border-color: var(--accent); background: rgba(255,255,255,0.08); box-shadow: 0 0 15px var(--glow); }
        .theme-box svg { width: 22px; height: 22px; stroke: var(--text-muted); stroke-width: 2; fill: none; }
        .theme-box.selected svg { stroke: var(--accent); }
        
        .theme-info h4 { font-size: 0.85rem; font-weight: 800; margin-bottom: 2px; }
        .theme-info p { font-size: 0.6rem; color: var(--text-muted); }

        .app-shell { width: 100%; max-width: 380px; padding: 30px 20px; display: flex; flex-direction: column; align-items: center; }
        .btn-batal { background: #FFFFFF; color: #000; border: none; font-size: 0.6rem; padding: 8px 18px; border-radius: 50px; cursor: pointer; font-weight: 800; }

        .stats-row { width: 100%; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 25px; }
        .stats-col { background: var(--card-bg); padding: 12px 5px; border-radius: 18px; border: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; }
        .stats-label { font-size: 0.45rem; color: var(--text-muted); font-weight: 800; }
        .stats-value { font-family: 'JetBrains Mono'; font-size: 0.7rem; color: var(--accent); }
        
        .rank-card { width: 100%; background: rgba(255,255,255,0.02); border: 1px solid var(--border); padding: 20px; border-radius: 25px; margin-bottom: 30px; }
        .rank-main { font-weight: 800; font-size: 0.95rem; color: var(--accent); letter-spacing: 2px; }
        .exp-track { width: 100%; height: 4px; background: rgba(255,255,255,0.04); border-radius: 10px; margin-top: 10px; overflow: hidden; }
        .exp-fill { height: 100%; background: var(--accent); width: 0%; transition: 1s cubic-bezier(0.2, 0.8, 0.2, 1); }

        .timer-circle { width: 140px; height: 140px; border-radius: 50%; border: 1px solid var(--border); display: flex; justify-content: center; align-items: center; background: var(--card-bg); transition: 0.5s; position: relative; }
        .timer-circle.active { border-color: var(--accent); box-shadow: 0 0 30px var(--glow); scale: 1.1; }

        .btn-mulai { padding: 12px 35px; border-radius: 100px; border: none; background: var(--accent); color: #000; font-weight: 800; cursor: pointer; box-shadow: 0 8px 20px var(--glow); margin-top: 30px; font-size: 0.7rem; transition: 0.3s; }
        .btn-selesai { margin-top: 20px; background: none; border: none; color: var(--text-muted); font-weight: 800; font-size: 0.6rem; cursor: pointer; border-bottom: 1px solid var(--border); }

        #bonus-pop { position: absolute; top: -30px; color: var(--accent); font-weight: 800; font-size: 0.7rem; opacity: 0; transition: 0.3s; pointer-events: none; }
        #bonus-pop.show { opacity: 1; transform: translateY(-10px); }

        /* Headphone Status Styling */
        .hp-indicator { display: flex; align-items: center; gap: 8px; margin-top: 15px; font-size: 0.55rem; font-weight: 800; color: var(--text-muted); transition: 0.3s; }
        .hp-dot { width: 6px; height: 6px; background: #6C727A; border-radius: 50%; }
        .hp-connected { color: var(--accent); }
        .hp-connected .hp-dot { background: var(--accent); box-shadow: 0 0 8px var(--accent); }
    </style>
</head>
<body class="mood-belajar">

    <div id="screen-welcome" class="screen">
        <h1 style="font-weight: 800; font-size: 1.6rem;">Nerdix Sentinel</h1>
        <p style="font-size: 0.55rem; color: var(--text-muted); letter-spacing: 1px; margin-top: 8px; font-weight: 600;">PILIH MODE KAMU YANG DI PRIORITASKAN</p>
        <div class="theme-grid">
            <div class="theme-box" id="t-ujian" onclick="pilihTema('ujian')">
                <svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                <div class="theme-info"><h4>UJIAN</h4><p>Fokus mutlak tanpa suara latar belakang.</p></div>
            </div>
            <div class="theme-box" id="t-belajar" onclick="pilihTema('belajar')">
                <svg viewBox="0 0 24 24"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
                <div class="theme-info"><h4>BELAJAR</h4><p>Ditemani audio Lofi untuk pemahaman mendalam.</p></div>
            </div>
            <div class="theme-box" id="t-tugas" onclick="pilihTema('tugas')">
                <svg viewBox="0 0 24 24"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
                <div class="theme-info"><h4>TUGAS</h4><p>Meningkatkan produktivitas pengerjaan tugas.</p></div>
            </div>
            <div class="theme-box" id="t-baca" onclick="pilihTema('baca')">
                <svg viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
                <div class="theme-info"><h4>BACA</h4><p>Ruang tenang untuk menyerap informasi buku.</p></div>
            </div>
        </div>
        <button class="btn-mulai" id="gas-btn" style="opacity:0.2; pointer-events:none;" onclick="navToAudio()">MULAI MISI</button>
    </div>

    <div id="screen-audio" class="screen hide">
        <svg id="audio-icon" style="width:70px; height:70px; margin-bottom:20px; transition: 0.5s;" viewBox="0 0 24 24" fill="none" stroke="var(--text-muted)" stroke-width="1.8">
            <path d="M3 18v-6a9 9 0 0 1 18 0v6"></path>
            <path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"></path>
        </svg>
        <h2 id="hp-title" style="font-size: 1.1rem; margin-bottom: 8px; letter-spacing: 1px;">MENUNGGU AUDIO</h2>
        <p id="hp-sub" style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 5px; text-align: center; padding: 0 40px;">Senyapkan dunia sekitarmu.</p>
        
        <div class="hp-indicator" id="hp-stat">
            <div class="hp-dot"></div>
            <span id="hp-text">SAMBUNGKAN HEADPHONE</span>
        </div>

        <button class="btn-mulai" id="hp-btn" style="width: 180px; opacity: 0.3; pointer-events: none;" onclick="navigasi('screen-audio', 'app-timer-screen')">SAYA SIAP</button>
        <button onclick="navigasi('screen-audio', 'screen-welcome')" style="background:none; border:none; color:var(--text-muted); font-size:0.55rem; margin-top:20px; cursor:pointer; font-weight:800;">KEMBALI</button>
    </div>

    <div id="app-timer-screen" class="screen hide">
        <div class="app-shell">
            <header style="width:100%; display:flex; justify-content:space-between; margin-bottom:25px; align-items:center;">
                <button class="btn-batal" onclick="navigasi('app-timer-screen', 'screen-welcome')">BATAL</button>
                <span id="st-label" style="font-size:0.5rem; font-weight:800; color:var(--text-muted); letter-spacing:1px;">SIAP</span>
            </header>
            <div class="stats-row">
                <div class="stats-col"><p class="stats-label">HARI INI</p><p class="stats-value" id="d-total">0d</p></div>
                <div class="stats-col" style="border-color: var(--accent);"><p class="stats-label">RANK</p><p class="stats-value" id="header-rank">SHELL</p></div>
                <div class="stats-col"><p class="stats-label">EXP</p><p class="stats-value" id="e-total">0</p></div>
            </div>
            <div class="rank-card">
                <div style="display:flex; justify-content:space-between; align-items:flex-end;">
                    <div><p style="font-size:0.45rem; color:var(--text-muted); margin-bottom:2px;">RANK KAMU</p><span class="rank-main" id="r-name">SHELL</span></div>
                    <span style="font-size:0.55rem; color:var(--text-muted); font-family:'JetBrains Mono';" id="r-progress">0/100</span>
                </div>
                <div class="exp-track"><div class="exp-fill" id="r-bar"></div></div>
            </div>
            <div class="timer-circle" id="t-circle">
                <span id="bonus-pop">LUCKY 9!</span>
                <div style="font-family:'JetBrains Mono'; font-size:2.8rem;" id="t-val">0<span style="font-size:1rem; color:var(--accent);">d</span></div>
            </div>
            <button class="btn-mulai" id="m-btn" onclick="toggle()">MULAI FOKUS</button>
            <button class="btn-selesai" id="f-btn" style="display:none;" onclick="selesai()">Selesaikan Sesi</button>
        </div>
    </div>

    <script>
        let detik = 0, jalan = false, timer;
        let exp = parseInt(localStorage.getItem('ocean_exp_v62') || 0);

        const ranks = [
            { n: "SHELL", cap: 100 }, { n: "SHELL", cap: 500 },
            { n: "CORAL", cap: 2000 }, { n: "PEARL", cap: 10000 },
            { n: "ABYSS", cap: 100000 }
        ];

        // --- DETEKSI HEADPHONE LOGIC ---
        function checkHeadphones() {
            if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices) return;

            navigator.mediaDevices.enumerateDevices().then(devices => {
                const hasHeadphones = devices.some(d => 
                    d.kind === 'audiooutput' && 
                    (d.label.toLowerCase().includes('head') || d.label.toLowerCase().includes('blue') || d.label.toLowerCase().includes('ear'))
                );

                const btn = document.getElementById('hp-btn');
                const stat = document.getElementById('hp-stat');
                const text = document.getElementById('hp-text');
                const icon = document.getElementById('audio-icon');

                if (hasHeadphones) {
                    stat.classList.add('hp-connected');
                    text.innerText = "HEADPHONE TERDETEKSI";
                    btn.style.opacity = "1";
                    btn.style.pointerEvents = "auto";
                    icon.style.stroke = "var(--accent)";
                    icon.style.filter = "drop-shadow(0 0 10px var(--accent))";
                    // Auto-pindah halus jika user sedang di screen audio
                    if(!document.getElementById('screen-audio').classList.contains('hide')) {
                        setTimeout(() => navigasi('screen-audio', 'app-timer-screen'), 1200);
                    }
                } else {
                    stat.classList.remove('hp-connected');
                    text.innerText = "SAMBUNGKAN HEADPHONE";
                    btn.style.opacity = "0.3";
                    btn.style.pointerEvents = "none";
                    icon.style.stroke = "var(--text-muted)";
                    icon.style.filter = "none";
                }
            });
        }

        setInterval(() => {
            if(!document.getElementById('screen-audio').classList.contains('hide')) checkHeadphones();
        }, 2000);

        function navToAudio() {
            // Meminta izin agar label device (headphone) muncul di browser mobile
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(s => { s.getTracks().forEach(t => t.stop()); checkHeadphones(); })
                .catch(() => checkHeadphones());
            
            navigasi('screen-welcome', 'screen-audio');
        }
        // --- END DETEKSI ---

        function navigasi(idKeluar, idMasuk) {
            document.getElementById(idKeluar).classList.add('hide');
            setTimeout(() => {
                document.getElementById(idMasuk).classList.remove('hide');
                if(idMasuk === 'app-timer-screen') updateStats();
                if(idMasuk === 'screen-welcome') selesai(); 
            }, 300);
        }

        function toggle() {
            if(!jalan) {
                jalan = true;
                document.getElementById('m-btn').innerText = "PAUSE";
                document.getElementById('t-circle').classList.add('active');
                document.getElementById('f-btn').style.display = "inline-block";
                timer = setInterval(() => {
                    detik++;
                    if(detik % 2 === 0) exp += 5;
                    if (detik.toString().includes('9')) {
                        let bonus = Math.floor(Math.random() * (5 - 3 + 1)) + 3;
                        exp += bonus;
                        tampilBonus();
                    }
                    document.getElementById('t-val').innerHTML = detik + '<span style="font-size:1rem; color:var(--accent);">d</span>';
                    updateStats();
                }, 1000);
            } else {
                jalan = false; clearInterval(timer);
                document.getElementById('m-btn').innerText = "LANJUTKAN";
                document.getElementById('t-circle').classList.remove('active');
            }
        }

        function tampilBonus() {
            const pop = document.getElementById('bonus-pop');
            pop.classList.add('show');
            setTimeout(() => pop.classList.remove('show'), 800);
        }

        function selesai() {
            const tgl = new Date().toDateString();
            const lama = parseInt(localStorage.getItem('hari_' + tgl) || 0);
            localStorage.setItem('hari_' + tgl, lama + detik);
            localStorage.setItem('ocean_exp_v62', exp);
            jalan = false; clearInterval(timer);
            detik = 0;
            document.getElementById('t-val').innerHTML = '0<span style="font-size:1rem; color:var(--accent);">d</span>';
            document.getElementById('m-btn').innerText = "MULAI FOKUS";
            document.getElementById('f-btn').style.display = "none";
            document.getElementById('t-circle').classList.remove('active');
            updateStats();
        }

        function updateRank() {
            let r = 0;
            while(r < ranks.length - 1 && exp >= ranks[r].cap) r++;
            const cur = ranks[r];
            const prevCap = r === 0 ? 0 : ranks[r-1].cap;
            const percent = ((exp - prevCap) / (cur.cap - prevCap)) * 100;
            document.getElementById('header-rank').innerText = cur.n;
            document.getElementById('r-name').innerText = cur.n;
            document.getElementById('r-progress').innerText = `${exp}/${cur.cap}`;
            document.getElementById('r-bar').style.width = Math.min(percent, 100) + "%";
        }

        function updateStats() {
            const tgl = new Date().toDateString();
            document.getElementById('d-total').innerText = (localStorage.getItem('hari_' + tgl) || 0) + "d";
            document.getElementById('e-total').innerText = exp;
            updateRank();
        }

        function pilihTema(m) {
            document.body.className = `mood-${m}`;
            document.querySelectorAll('.theme-box').forEach(b => b.classList.remove('selected'));
            document.getElementById('t-'+m).classList.add('selected');
            document.getElementById('gas-btn').style.opacity = "1";
            document.getElementById('gas-btn').style.pointerEvents = "auto";
        }

        updateStats();
    </script>
</body>
</html>
