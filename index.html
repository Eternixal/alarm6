<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nerdix Sentinel | v4.0.7</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=download" />
    
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#090B0E">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Nerdix Sentinel">

    <style>
        :root {
            --bg: #090B0E;
            --card-bg: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --text-main: #EEF0F2;
            --text-muted: #6C727A;
            --accent: #2EE7B7; 
            --glow: rgba(46, 231, 183, 0.15);
        }

        body.mood-study { --accent: #2EE7B7; --glow: rgba(46, 231, 183, 0.15); }
        body.mood-read { --accent: #FBBF24; --glow: rgba(251, 191, 36, 0.15); }
        body.mood-work { --accent: #38BDF8; --glow: rgba(56, 189, 248, 0.15); }
        body.mood-create { --accent: #C084FC; --glow: rgba(192, 132, 252, 0.15); }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; justify-content: center; background-image: radial-gradient(circle at 50% 10%, var(--glow) 0%, #090b0e 100%); transition: 0.5s ease; }

        /* LAYAR AWAL */
        #welcome-screen { 
            position: fixed; inset: 0; background: var(--bg); z-index: 5000; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #welcome-screen.hide { opacity: 0; pointer-events: none; transform: scale(1.1); }

        .orbit-container {
            position: relative;
            width: 300px; height: 300px;
            display: flex; align-items: center; justify-content: center;
            margin: 30px 0;
        }

        .center-axis {
            font-size: 3.5rem;
            z-index: 10;
            filter: drop-shadow(0 0 20px var(--accent));
            animation: spin-hourglass 4s cubic-bezier(0.45, 0.05, 0.55, 0.95) infinite;
        }

        @keyframes spin-hourglass {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .mode-card {
            position: absolute;
            width: 90px; height: 90px;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 24px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(8px);
        }

        .card-1 { transform: translate(0, -115px); }
        .card-2 { transform: translate(115px, 0); }
        .card-3 { transform: translate(0, 115px); }
        .card-4 { transform: translate(-115px, 0); }

        .mode-card.selected { border-color: var(--accent); background: rgba(255,255,255,0.12); box-shadow: 0 0 25px var(--glow); transform: scale(1.1); }
        .mode-card.selected.card-1 { transform: translate(0, -115px) scale(1.1); }
        .mode-card.selected.card-2 { transform: translate(115px, 0) scale(1.1); }
        .mode-card.selected.card-3 { transform: translate(0, 115px) scale(1.1); }
        .mode-card.selected.card-4 { transform: translate(-115px, 0) scale(1.1); }

        /* TAMPILAN UTAMA */
        .app-shell { width: 100%; max-width: 360px; padding: 40px 20px; display: flex; flex-direction: column; align-items: center; }
        .timer-panel { width: 100%; background: var(--card-bg); border: 1px solid var(--border); border-radius: 40px; padding: 30px 10px; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(20px); }
        .digit { font-family: 'JetBrains Mono', monospace; font-size: 2.8rem; text-shadow: 0 0 15px var(--glow); }
        
        .preset-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; width: 100%; margin-top: 25px; }
        .btn-preset { 
            background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; 
            padding: 12px 5px; color: var(--text-main); font-size: 0.65rem; font-family: 'JetBrains Mono';
            cursor: pointer; transition: 0.2s;
        }

        .btn-main { padding: 20px 45px; border-radius: 100px; border: none; background: var(--accent); color: #000; font-weight: 800; cursor: pointer; box-shadow: 0 10px 30px var(--glow); width: 100%; transition: 0.3s; }

        #finish-notice { position: fixed; inset: 0; background: var(--bg); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; text-align: center; }
        
        #install-btn { 
            display:none; margin-top: 15px; background:rgba(255,255,255,0.05); border:1px solid var(--border); 
            color:var(--text-main); font-size:0.65rem; padding:12px 20px; border-radius:50px; font-weight:800; 
            cursor:pointer; width: 220px; letter-spacing: 1px; align-items: center; justify-content: center; 
            gap: 8px; transition: 0.3s; 
        }
    </style>
</head>
<body class="mood-work">

    <div id="welcome-screen">
        <div style="text-align: center; margin-bottom: 10px;">
            <h1 style="font-weight: 800; letter-spacing: -1.5px; font-size: 1.8rem;">Nerdix Sentinel</h1>
            <p style="font-size: 0.6rem; letter-spacing: 2px; color: var(--text-muted); font-weight: 700;">PILIH MODE FOKUS</p>
        </div>
        
        <div class="orbit-container">
            <div class="center-axis">âŒ›</div>
            <div class="mode-card card-1" id="card-work" onclick="selectInitialMode('work')">
                <span style="font-size:1.6rem">ðŸ’¼</span>
                <span style="font-size:0.55rem; font-weight:800; margin-top:5px">KERJA</span>
            </div>
            <div class="mode-card card-2" id="card-study" onclick="selectInitialMode('study')">
                <span style="font-size:1.6rem">ðŸ“–</span>
                <span style="font-size:0.55rem; font-weight:800; margin-top:5px">BELAJAR</span>
            </div>
            <div class="mode-card card-3" id="card-create" onclick="selectInitialMode('create')">
                <span style="font-size:1.6rem">ðŸŽ¨</span>
                <span style="font-size:0.55rem; font-weight:800; margin-top:5px">KARYA</span>
            </div>
            <div class="mode-card card-4" id="card-read" onclick="selectInitialMode('read')">
                <span style="font-size:1.6rem">ðŸ“‘</span>
                <span style="font-size:0.55rem; font-weight:800; margin-top:5px">BACA</span>
            </div>
        </div>

        <button class="btn-main" id="welcome-go" style="opacity: 0.1; pointer-events: none; width: 220px;" onclick="enterApp()">MULAI SEKARANG</button>
        
        <button id="install-btn">
            <span class="material-symbols-outlined" style="font-size: 18px; color: var(--accent);">download</span>
            DOWNLOAD APP
        </button>
    </div>

    <div class="app-shell">
        <header style="width:100%; display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
            <button onclick="exitApp()" style="background:var(--card-bg); border:1px solid var(--border); color:var(--text-muted); font-size:0.55rem; padding:8px 15px; border-radius:50px; cursor:pointer; font-weight:800;">GANTI MODE</button>
            <div id="status-label" style="font-size:0.55rem; opacity:0.7; font-weight:800; letter-spacing:1px;">SIAP</div>
        </header>

        <div class="intent-section" style="width:100%; background:var(--card-bg); border-left:3px solid var(--accent); padding:18px; border-radius:18px; margin-bottom:25px;">
            <div id="task-stack"></div>
            <input type="text" id="session-intent" style="background:transparent; border:none; color:var(--text-main); width:100%; font-size:0.85rem; font-weight:600; outline:none;" placeholder="Lagi mau ngerjain apa?">
        </div>

        <div class="timer-panel">
            <div class="unit-box" style="text-align:center">
                <button class="adjust-btn" onclick="adj('h',1)" style="background:none; border:none; color:var(--accent); font-size:1.2rem; cursor:pointer">+</button>
                <div class="digit" id="h-val">00</div>
                <button class="adjust-btn" onclick="adj('h',-1)" style="background:none; border:none; color:var(--accent); font-size:1.2rem; cursor:pointer">âˆ’</button>
            </div>
            <div style="font-size: 1.5rem; opacity: 0.2; margin: 15px 10px 0;">:</div>
            <div class="unit-box" style="text-align:center">
                <button class="adjust-btn" onclick="adj('m',1)" style="background:none; border:none; color:var(--accent); font-size:1.2rem; cursor:pointer">+</button>
                <div class="digit" id="m-val">00</div>
                <button class="adjust-btn" onclick="adj('m',-1)" style="background:none; border:none; color:var(--accent); font-size:1.2rem; cursor:pointer">âˆ’</button>
            </div>
            <div style="font-size: 1.5rem; opacity: 0.2; margin: 15px 10px 0;">:</div>
            <div class="unit-box" style="text-align:center">
                <button class="adjust-btn" onclick="adj('s',1)" style="background:none; border:none; color:var(--accent); font-size:1.2rem; cursor:pointer">+</button>
                <div class="digit" id="s-val">00</div>
                <button class="adjust-btn" onclick="adj('s',-1)" style="background:none; border:none; color:var(--accent); font-size:1.2rem; cursor:pointer">âˆ’</button>
            </div>
        </div>

        <div class="preset-grid" id="preset-grid"></div>

        <button class="btn-main" id="action-btn" onclick="handleAction()" style="margin-top:40px;">MULAI FOKUS</button>
        <div id="cancel-zone" style="display:none; margin-top:20px;">
            <button onclick="cancelSession()" style="background:none; border:none; color:var(--text-muted); font-size:0.65rem; cursor:pointer; text-decoration:underline;">Batalkan Waktu</button>
        </div>
    </div>

    <div id="finish-notice">
        <div style="font-size: 70px;">ðŸŽ‰</div>
        <h2 style="font-weight: 800; margin-top: 20px;">WAKTU HABIS!</h2>
        <p id="last-task-display" style="color: var(--accent); margin: 20px 0; font-weight: 700; font-size:1.1rem;"></p>
        <button class="btn-main" onclick="stayInTheme()" style="width:200px">OKE, SIAP</button>
    </div>

    <div style="position:absolute; top:-999px"><div id="lofi-player"></div><div id="reward-player"></div></div>

    <script>
        // SERVICE WORKER
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => { navigator.serviceWorker.register('/sw.js'); });
        }

        // INSTALL LOGIC
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'flex';
        });

        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            deferredPrompt = null;
            installBtn.style.display = 'none';
        });

        window.addEventListener('appinstalled', () => {
            installBtn.style.display = 'none';
        });

        // APP LOGIC
        const focusModes = {
            work: { video: "lkkGlVWvkLk", hints: ["Beresin email...", "Tulis laporan...", "Cek data..."], presets: ["00:05:00", "00:15:00", "00:25:00", "00:45:00", "01:00:00", "01:30:00"] },
            study: { video: "Z8ANihFXlgU", hints: ["Baca materi...", "Latihan soal...", "Review bab..."], presets: ["00:10:00", "00:20:00", "00:30:00", "00:45:00", "01:00:00", "01:15:00"] },
            read: { video: "n4YghVcjbpw", hints: ["Baca buku...", "Review artikel...", "Cek berita..."], presets: ["00:05:00", "00:10:00", "00:15:00", "00:20:00", "00:30:00", "00:45:00"] },
            create: { video: "dUqdlL_k6x8", hints: ["Gambar sketsa...", "Edit video...", "Tulis ide..."], presets: ["00:30:00", "01:00:00", "01:30:00", "02:00:00", "03:00:00", "04:00:00"] }
        };

        let h=0, m=0, s=0, totalSec=0, isRunning=false, isPaused=false, currentMode="work", hintIdx=0, hintInterval, timerInterval;
        let lofiPlayer, rewardPlayer;

        function adj(u, d) {
            if(isRunning) return;
            if(u==='h') { h+=d; if(h<0) h=23; if(h>23) h=0; }
            if(u==='m') { m+=d; if(m<0) m=59; if(m>59) m=0; }
            if(u==='s') { s+=d; if(s<0) s=59; if(s>59) s=0; }
            updateDisplay();
        }

        function updateDisplay() {
            document.getElementById('h-val').innerText = h.toString().padStart(2, '0');
            document.getElementById('m-val').innerText = m.toString().padStart(2, '0');
            document.getElementById('s-val').innerText = s.toString().padStart(2, '0');
        }

        function selectInitialMode(mode) {
            currentMode = mode;
            document.body.className = `mood-${mode}`;
            document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('selected'));
            document.getElementById(`card-${mode}`).classList.add('selected');
            document.getElementById('welcome-go').style.opacity = "1";
            document.getElementById('welcome-go').style.pointerEvents = "auto";
            
            const grid = document.getElementById('preset-grid');
            grid.innerHTML = "";
            focusModes[mode].presets.forEach(p => {
                const btn = document.createElement('button');
                btn.className = 'btn-preset';
                btn.innerText = p;
                btn.onclick = () => { if(!isRunning) { const t=p.split(':'); h=parseInt(t[0]); m=parseInt(t[1]); s=parseInt(t[2]); updateDisplay(); }};
                grid.appendChild(btn);
            });

            const input = document.getElementById('session-intent');
            if(hintInterval) clearInterval(hintInterval);
            hintInterval = setInterval(() => {
                if(!isRunning && !input.value) {
                    input.placeholder = focusModes[currentMode].hints[hintIdx];
                    hintIdx = (hintIdx + 1) % focusModes[currentMode].hints.length;
                }
            }, 3000);
        }

        function handleAction() {
            if(!isRunning) {
                const input = document.getElementById('session-intent');
                if(!input.value.trim() || (h+m+s === 0)) return;
                totalSec = (h*3600)+(m*60)+s;
                startTimer();
            } else { if(!isPaused) pauseTimer(); else resumeTimer(); }
        }

        function startTimer() {
            isRunning = true; isPaused = false;
            document.getElementById('action-btn').innerText = "JEDA SEBENTAR";
            document.getElementById('status-label').innerText = "LAGI FOKUS...";
            document.getElementById('cancel-zone').style.display = 'block';
            document.querySelectorAll('.adjust-btn').forEach(b => b.style.visibility = 'hidden');
            if(lofiPlayer) { lofiPlayer.unMute(); lofiPlayer.playVideo(); }
            runCountdown();
        }

        function pauseTimer() {
            isPaused = true; clearInterval(timerInterval);
            document.getElementById('action-btn').innerText = "LANJUTKAN LAGI";
            document.getElementById('status-label').innerText = "BERHENTI";
            if(lofiPlayer) lofiPlayer.pauseVideo();
        }

        function resumeTimer() {
            isPaused = false;
            document.getElementById('action-btn').innerText = "JEDA SEBENTAR";
            document.getElementById('status-label').innerText = "LAGI FOKUS...";
            if(lofiPlayer) lofiPlayer.playVideo();
            runCountdown();
        }

        function runCountdown() {
            timerInterval = setInterval(() => {
                if(totalSec > 0) {
                    totalSec--;
                    h = Math.floor(totalSec/3600); m = Math.floor((totalSec%3600)/60); s = totalSec%60;
                    updateDisplay();
                } else { finishSession(); }
            }, 1000);
        }

        function resetUI() {
            isRunning = false; h=0; m=0; s=0; updateDisplay();
            document.getElementById('action-btn').innerText = "MULAI FOKUS";
            document.getElementById('status-label').innerText = "SIAP";
            document.getElementById('cancel-zone').style.display = 'none';
            document.querySelectorAll('.adjust-btn').forEach(b => b.style.visibility = 'visible');
            document.getElementById('session-intent').value = "";
            if(lofiPlayer) lofiPlayer.stopVideo();
        }

        function cancelSession() { clearInterval(timerInterval); resetUI(); }

        function finishSession() {
            clearInterval(timerInterval);
            document.getElementById('last-task-display').innerText = document.getElementById('session-intent').value;
            const item = document.createElement('div');
            item.style.fontSize = "0.7rem"; item.style.opacity = "0.4"; item.style.textDecoration = "line-through";
            item.innerText = "âœ“ " + document.getElementById('session-intent').value;
            document.getElementById('task-stack').appendChild(item);
            document.getElementById('finish-notice').style.display = 'flex';
            resetUI();
            if(rewardPlayer) { rewardPlayer.unMute(); rewardPlayer.playVideo(); }
        }

        function enterApp() { document.getElementById('welcome-screen').classList.add('hide'); }
        function exitApp() { document.getElementById('welcome-screen').classList.remove('hide'); }
        function stayInTheme() { document.getElementById('finish-notice').style.display = 'none'; if(rewardPlayer) rewardPlayer.stopVideo(); }

        var tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        function onYouTubeIframeAPIReady() {
            lofiPlayer = new YT.Player('lofi-player', { height: '1', width: '1', videoId: 'lkkGlVWvkLk' });
            rewardPlayer = new YT.Player('reward-player', { height: '1', width: '1', videoId: 'do5EbohsUUk' });
        }
    </script>
</body>
</html>
